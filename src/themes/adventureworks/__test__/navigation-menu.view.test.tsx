/*!
 * Copyright (c) Microsoft Corporation.
 * All rights reserved. See LICENSE in the project root for license information.
 */

import { buildMockModuleProps, IImageData, ILinkData } from '@msdyn365-commerce/core';
import { INavigationMenuViewProps } from '@msdyn365-commerce-modules/navigation-menu';
import { mount } from 'enzyme';
import * as React from 'react';

import {
    ICategoryPromotionalContentData,
    INavigationMenuConfig,
    INavigationMenuProps,
    INavigationMenuResources
} from '../definition-extensions/navigation-menu.ext.props.autogenerated';
import NavigationMenuView from '../views/navigation-menu.view';

const mockConfig: INavigationMenuConfig = {
    navigationMenuSource: undefined,
    cmsNavItems: [
        {
            linkText: 'Participate',
            subMenus: [
                {
                    linkText: 'Contact',
                    linkUrl: {
                        destinationUrl: '/modern/',
                        type: 'internalLink'
                    },
                    ariaLabel: 'Contact us',
                    subMenus: [
                        {
                            linkText: 'Support',
                            linkUrl: {
                                destinationUrl: '/modern/',
                                type: 'internalLink'
                            },
                            ariaLabel: 'Support'
                        },
                        {
                            linkText: 'Customer Care',
                            linkUrl: {
                                destinationUrl: '/modern/',
                                type: 'internalLink'
                            },
                            ariaLabel: 'Customer Care'
                        }
                    ]
                },
                {
                    linkText: 'Loyalty program',
                    linkUrl: {
                        destinationUrl: '/modern/',
                        type: 'internalLink'
                    }
                }
            ]
        },
        {
            linkText: 'Initiative',
            image: {
                src: 'https://cms-ppe-imageresizer-mr.trafficmanager.net/cms/api/jswzvrwzrf/imageFileData/LAkOO?ver=63ed',
                altText: 'yoga',
                width: 344,
                height: 450,
                title: 'yoga_bg-Adventureworks.png',
                imageSettings: {
                    quality: 80,
                    disableLazyLoad: false,
                    lazyload: true,
                    viewports: {
                        xs: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                        lg: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                        xl: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' }
                    }
                }
            },
            subMenus: [
                {
                    linkText: 'Promote',
                    linkUrl: {
                        destinationUrl: '/modern/',
                        type: 'internalLink'
                    },
                    image: {
                        src: 'https://cms-ppe-imageresizer-mr.trafficmanager.net/cms/api/jswzvrwzrf/imageFileData/LAkPa?ver=fac0',
                        altText: 'Home',
                        width: 203,
                        height: 203,
                        title: '',
                        imageSettings: {
                            quality: 80,
                            disableLazyLoad: false,
                            lazyload: true,
                            viewports: {
                                xs: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                                lg: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                                xl: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' }
                            }
                        }
                    }
                }
            ]
        }
    ],
    enableMultilevelMenu: true,
    enabletopMenu: true,
    menuLevelSupport: 4,
    rootMenuNavigation: 'Shop',
    displayCategoryImage: true,
    displayPromotionalImage: true,
    categoryImageSettings: {
        quality: 80,
        disableLazyLoad: true,
        lazyload: true,
        viewports: {
            xs: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
            lg: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
            xl: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' }
        }
    }
};

const mockResources: INavigationMenuResources = {
    menuAriaLabel: 'string',
    backButtonAriaLabel: 'string',
    allCategoryMenuText: 'string',
    hamburgerAriaLabel: 'string'
};

interface IMenuItemData {
    // eslint-disable-next-line @typescript-eslint/naming-convention -- used in test file only
    id?: number;
    linkText?: string;
    // eslint-disable-next-line @typescript-eslint/naming-convention -- linkURL used in test file only
    linkURL?: string;
    imageSource?: string;
    // eslint-disable-next-line @typescript-eslint/naming-convention -- used in test file only
    imageDestinationURL?: string;
    subMenu?: IMenuItemData[];
    promotionalContent?: ICategoryPromotionalContentData[];
    menuSource?: string;
}
const mockFunction = jest.fn();

const linkData: ILinkData = { destinationUrl: 'https://xyz.com' };
const imageData: IImageData = {
    src: 'https://cms-ppe-imageresizer-mr.trafficmanager.net/cms/api/jswzvrwzrf/imageFileData/LAkPa?ver=fac0',
    altText: 'Home',
    width: 203,
    height: 203,
    title: '',
    imageSettings: {
        quality: 80,
        disableLazyLoad: false,
        lazyload: true,
        viewports: {
            xs: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
            lg: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
            xl: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' }
        }
    }
};
const promo: ICategoryPromotionalContentData = { categoryName: '123123', text: 'Category 1', linkUrl: linkData, image: imageData };
const moduleProps = buildMockModuleProps({}, {}, mockConfig) as INavigationMenuViewProps;

const menuData: IMenuItemData = {
    id: 4343106098,
    linkText: 'main-menu-mock',
    linkURL: 'https://xyz.com',
    imageSource: 'abc/xyz.png',
    subMenu: [
        {
            id: 4295341244,
            linkText: 'sub-menu-mock',
            linkURL: 'https://xyz.com',
            imageSource: 'abc/xyz.png',
            promotionalContent: [promo],
            subMenu: [
                {
                    id: 4219573105,
                    linkText: 'sub-menu-mock',
                    linkURL: 'https://xyz.com',
                    imageSource: 'abc/xyz.png'
                },
                {
                    id: 8696202733,
                    linkText: 'sub-menu-mock',
                    linkURL: 'https://xyz.com',
                    imageSource: 'abc/xyz.png'
                }
            ]
        }
    ]
};

const mockProps: INavigationMenuViewProps & INavigationMenuProps<{}> = {
    ...moduleProps,
    className: 'Mock-class',
    id: 'mock-test',
    menuItemData: [menuData],
    isMobileView: true,
    showCategoryImage: true,
    showPromotionalContent: true,
    Navigation: {
        moduleProps,
        className: 'ms-nav',
        tag: 'nav',
        role: 'navigation',
        'aria-label': 'Menu'
    },
    MenuList: {
        className: 'ms-nav__list',
        tag: 'ul'
    },
    ListItem: {
        className: 'ms-nav__list__item',
        tag: 'li'
    },
    DivContainer: {
        tag: 'div',
        className: 'ms-nav__feature',
        role: 'menu'
    },
    ImageDivContainer: {
        tag: 'div',
        className: 'category-image',
        role: 'menu'
    },
    Link: {
        tag: 'a',
        className: 'ms-nav__list__item__link',
        onMouseEnter: mockFunction,
        onMouseLeave: mockFunction,
        onMouseOver: mockFunction
    },
    Button: {
        className: 'ms-nav__list__item__button',
        tag: 'button',
        onClick: mockFunction
    },
    ImageContainer: {
        className: 'ms-nav__list__item__image'
    },
    Span: {
        className: 'ms-nav__list__item__span',
        tag: 'span'
    },
    MobileDescriptionContainer: {
        className: 'ms-nav__list__mobile__container'
    },
    MobileBackButton: {
        className: 'ms-nav__list__mobile__container__button',
        tag: 'button',
        onClick: mockFunction
    },
    MobileDescriptionLabel: {
        className: 'ms-nav__list__mobile__container__span',
        tag: 'span'
    },
    resources: mockResources,
    config: {
        navigationMenuSource: undefined,
        cmsNavItems: [
            {
                linkText: 'Participate',
                subMenus: [
                    {
                        linkText: 'Contact',
                        linkUrl: {
                            destinationUrl: '/modern/',
                            type: 'internalLink'
                        },
                        ariaLabel: 'Contact us',
                        subMenus: [
                            {
                                linkText: 'Support',
                                linkUrl: {
                                    destinationUrl: '/modern/',
                                    type: 'internalLink'
                                },
                                ariaLabel: 'Support'
                            },
                            {
                                linkText: 'Customer Care',
                                linkUrl: {
                                    destinationUrl: '/modern/',
                                    type: 'internalLink'
                                },
                                ariaLabel: 'Customer Care'
                            }
                        ]
                    },
                    {
                        linkText: 'Loyalty program',
                        linkUrl: {
                            destinationUrl: '/modern/',
                            type: 'internalLink'
                        }
                    }
                ]
            },
            {
                linkText: 'Initiative',
                image: {
                    src: 'https://cms-ppe-imageresizer-mr.trafficmanager.net/cms/api/jswzvrwzrf/imageFileData/LAkOO?ver=63ed',
                    altText: 'yoga',
                    width: 344,
                    height: 450,
                    title: 'yoga_bg-Adventureworks.png',
                    imageSettings: {
                        quality: 80,
                        disableLazyLoad: false,
                        lazyload: true,
                        viewports: {
                            xs: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                            lg: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                            xl: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' }
                        }
                    }
                },
                subMenus: [
                    {
                        linkText: 'Promote',
                        linkUrl: {
                            destinationUrl: '/modern/',
                            type: 'internalLink'
                        },
                        image: {
                            src: 'https://cms-ppe-imageresizer-mr.trafficmanager.net/cms/api/jswzvrwzrf/imageFileData/LAkPa?ver=fac0',
                            altText: 'Home',
                            width: 203,
                            height: 203,
                            title: '',
                            imageSettings: {
                                quality: 80,
                                disableLazyLoad: false,
                                lazyload: true,
                                viewports: {
                                    xs: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                                    lg: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                                    xl: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' }
                                }
                            }
                        }
                    }
                ]
            }
        ],
        enableMultilevelMenu: true,
        enabletopMenu: true,
        menuLevelSupport: 4,
        rootMenuNavigation: 'Shop',
        displayCategoryImage: true,
        displayPromotionalImage: true,
        categoryImageSettings: {
            quality: 80,
            disableLazyLoad: true,
            lazyload: true,
            viewports: {
                xs: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                lg: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' },
                xl: { w: 300, h: 350, q: 'w=300&h=350&q=80&m=6&f=jpg' }
            }
        }
    }
};

describe('Navigation Menu Unit Test', () => {
    it('View renders correctly top menu enabled', () => {
        const wrapper = mount(<NavigationMenuView {...mockProps} />);
        const button = wrapper.find('button');
        expect(button).toBeDefined();
        wrapper.unmount();
    });

    it('View renders correctly top menu disabled', () => {
        mockProps.config.enabletopMenu = false;
        const wrapper = mount(<NavigationMenuView {...mockProps} />);
        const button = wrapper.find('button');
        expect(button).toBeDefined();
        wrapper.unmount();
    });
});
